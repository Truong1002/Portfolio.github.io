<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatbot Fullscreen</title>

  <!-- ‚úÖ Th√™m CSS ch√≠nh th·ª©c t·ª´ @n8n -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" />

  <style>
    @charset "UTF-8";

    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
    }

    #chat-widget-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-height: 100vh;
      overflow: hidden;
      background: #fff;
    }

    .chat-messages[data-v-31e29ba2] {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 0.5rem;
    }

    :root {
      --chat--color-primary: #FB6A18;
      --chat--color-primary-shade-50: #FB6A18;
      --chat--color-primary-shade-100: #FB6A18;
      --chat--color-secondary: #f46c1a;
      --chat--color-white: #ffffff;
      --chat--color-light: #f2f4f8;
      --chat--color-dark: #101330;
      --chat--color-disabled: #777980;
      --chat--color-typing: #404040;

      --chat--spacing: 1rem;
      --chat--border-radius: 0.25rem;
      --chat--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;

      --chat--input--background: var(--chat--color-white);
      --chat--input--send--button--color: var(--chat--color-white);
      --chat--input--send--button--background-hover: var(--chat--color-primary-shade-50);

      --chat--toggle--background: var(--chat--color-primary);
      --chat--toggle--hover--background: var(--chat--color-primary-shade-50);
      --chat--toggle--active--background: var(--chat--color-primary-shade-100);
      --chat--toggle--color: var(--chat--color-white);
      --chat--message--border-radius:10px;
      --chat--message--user--color:white
    }

    .chat-inputs[data-v-31e29ba2] {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: sticky;
      bottom: 0;
      background: white;
      padding: 0.5rem;
      border-top: 1px solid #ddd;
      z-index: 10;
    }

    .chat-inputs textarea[data-v-31e29ba2] {
      flex: 1;
      height: 50px !important;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border-radius: 0.25rem;
      border: 1px solid #ccc;
      resize: none;
      box-sizing: border-box;
      background: var(--chat--input--background);
    }

    .chat-inputs-controls[data-v-31e29ba2] {
      display: flex;
      align-items: center;
      height: 100%;
    }

    .chat-input-send-button[data-v-31e29ba2] {
      height: 50px;
      width: 50px;
      background: var(--chat--toggle--background);
      color: #fb6a18;
      border: none;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }

    .chat-input-send-button[data-v-de5e7961] {
      height: 50px;
      width: 50px;
      color: #fb6a18;
      border: none;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }

    .chat-input-send-button[data-v-31e29ba2]:hover {
      background: var(--chat--toggle--hover--background);
    }

    .chat-input-send-button[data-v-31e29ba2]:disabled {
      cursor: not-allowed;
      background: #ccc !important;
    }

    .chat-messages-list {
      height: 100%;
    }

    .chat-layout .chat-header {
      background-color: #FB6A18;
      height: 2%;
      align-items: left;
    }
    
    .chat-layout .chat-header h1 {
      font-size: 20px;
      font-weight: 700;
    }
    .chat-message-markdown a {
  text-decoration: underline !important;
}
.chat-message-markdown a:hover{
   color: #0066cc; /* Tu·ª≥ ch·ªçn: m√†u link d·ªÖ nh·∫≠n bi·∫øt */
}
    html, body {
  overflow-x: hidden;
  width: 100%!important;
}
*, *::before, *::after {
  box-sizing: border-box;
}
#chat-widget-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-height: 100vh;
  overflow-x: hidden;
  overflow-y: auto;
  width: 100%;
}

/* Styling cho file upload v√† voice input */
.chat-file-input-wrapper, .chat-voice-input-wrapper {
  position: relative;
  display: inline-block;
}

.chat-file-input-button, .chat-voice-input-button {
  background: var(--chat--toggle--background, #FB6A18);
  color: var(--chat--toggle--color, white);
  border: none;
  border-radius: 0.25rem;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s;
  margin-left: 0.5rem;
}

.chat-file-input-button:hover, .chat-voice-input-button:hover {
  background: var(--chat--toggle--hover--background, #f46c1a);
}

.chat-voice-input-button.recording {
  background: #dc3545;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
  }
}

.chat-file-input-button svg, .chat-voice-input-button svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

/* File upload progress v√† th√¥ng b√°o */
.chat-file-upload-status {
  position: absolute;
  bottom: 100%;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.875rem;
  margin-bottom: 0.5rem;
  z-index: 1000;
}

/* Styling cho file attachments trong message */
.chat-message-attachment {
  background: rgba(251, 106, 24, 0.1);
  border: 1px solid #FB6A18;
  border-radius: 0.25rem;
  padding: 0.5rem;
  margin: 0.5rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.chat-message-attachment-icon {
  width: 20px;
  height: 20px;
  color: #FB6A18;
}

.chat-message-attachment-info {
  flex: 1;
}

.chat-message-attachment-name {
  font-weight: 600;
  color: #333;
}

.chat-message-attachment-size {
  color: #666;
  font-size: 0.75rem;
}

/* Voice input status notifications */
.voice-status {
  position: fixed !important;
  top: 20px !important;
  right: 20px !important;
  padding: 12px 20px !important;
  border-radius: 8px !important;
  color: white !important;
  font-family: var(--chat--font-family) !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
  z-index: 10000 !important;
  transition: all 0.3s ease !important;
  backdrop-filter: blur(10px) !important;
}

/* Recording indicator cho textarea */
.chat-inputs textarea.listening {
  border-color: #dc3545 !important;
  box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2) !important;
}

/* Floating voice button - backup solution */
.floating-voice-button {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--chat--toggle--background, #FB6A18);
  color: white;
  border: none;
  cursor: pointer;
  z-index: 1000;
  display: none;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.floating-voice-button:hover {
  background: var(--chat--toggle--hover--background, #f46c1a);
  transform: scale(1.1);
}

.floating-voice-button.recording {
  background: #dc3545;
  animation: pulse 1.5s infinite;
}

.floating-voice-button svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.floating-voice-button.show {
  display: flex;
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .floating-voice-button {
    width: 70px;
    height: 70px;
    bottom: 100px;
    right: 15px;
  }
  
  .floating-voice-button svg {
    width: 28px;
    height: 28px;
  }
  
  .voice-status {
    font-size: 16px !important;
    padding: 15px 20px !important;
    border-radius: 10px !important;
    max-width: 85vw !important;
  }
  
  .chat-voice-input-button, .chat-file-input-button {
    width: 55px;
    height: 55px;
    margin-left: 0.25rem;
  }
  
  .chat-voice-input-button svg, .chat-file-input-button svg {
    width: 24px;
    height: 24px;
  }
}

  </style>

  <script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    createChat({
      webhookUrl: 'https://n8n-7tuvkz.tino.page/webhook/ec4e2f4e-352f-4f0d-8f24-c03427eeb8e7/chat',
      target: '#chat-widget-container',
      mode: 'fullscreen',
      defaultLanguage: 'vi',
      allowFileUploads: true,
      allowedFilesMimeTypes: 'image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/*,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      initialMessages: [
  
],
      i18n: {
        vi: {
          title: 'ü§ñ Chatbot c√° nh√¢n',
          subtitle: '',
          inputPlaceholder: 'Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...',
          getStarted: 'B·∫Øt ƒë·∫ßu h·ªôi tho·∫°i',
        },
      },
    });

    // Voice Input Functionality
    let recognition = null;
    let isRecording = false;
    
    // Ph√°t hi·ªán mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    function initVoiceInput() {
      // Ki·ªÉm tra Web Speech API support
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        
        // C√†i ƒë·∫∑t t·ªëi ∆∞u cho mobile
        
        recognition.continuous = false; // Kh√¥ng continuous ƒë·ªÉ tr√°nh ch·∫≠p ch·ªùn
        recognition.interimResults = !isMobile; // T·∫Øt interim results tr√™n mobile
        recognition.lang = 'vi-VN'; // Ti·∫øng Vi·ªát
        recognition.maxAlternatives = 1; // Ch·ªâ l·∫•y 1 k·∫øt qu·∫£ t·ªët nh·∫•t
        
        if (isMobile) {
          // C√†i ƒë·∫∑t ƒë·∫∑c bi·ªát cho mobile
          recognition.serviceURI = null; // S·ª≠ d·ª•ng service m·∫∑c ƒë·ªãnh
        }
        
        recognition.onstart = function() {
          isRecording = true;
          const voiceBtn = document.querySelector('.chat-voice-input-button');
          const floatingBtn = document.getElementById('floatingVoiceBtn');
          const textarea = document.querySelector('.chat-inputs textarea');
          
          if (voiceBtn) {
            voiceBtn.classList.add('recording');
            voiceBtn.title = 'ƒêang ghi √¢m... Nh·∫•n ƒë·ªÉ d·ª´ng';
          }
          if (floatingBtn) {
            floatingBtn.classList.add('recording');
            floatingBtn.title = 'ƒêang ghi √¢m... Nh·∫•n ƒë·ªÉ d·ª´ng';
          }
          if (textarea) {
            textarea.classList.add('listening');
          }
        };
        
        recognition.onresult = function(event) {
          let finalTranscript = '';
          let interimTranscript = '';
          
          // X·ª≠ l√Ω k·∫øt qu·∫£ t·ª´ speech recognition
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript.trim();
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          const textarea = document.querySelector('.chat-inputs textarea');
          if (textarea) {
            if (finalTranscript) {
              // Ch·ªâ c·∫≠p nh·∫≠t khi c√≥ final transcript
              textarea.value = finalTranscript;
              textarea.dispatchEvent(new Event('input', { bubbles: true }));
              
              // T·ª± ƒë·ªông d·ª´ng recognition sau khi c√≥ k·∫øt qu·∫£ (mobile friendly)
              if (isMobile && recognition && isRecording) {
                setTimeout(() => {
                  recognition.stop();
                }, 100);
              }
            } else if (interimTranscript && !isMobile) {
              // Ch·ªâ hi·ªÉn th·ªã interim tr√™n desktop
              const currentValue = textarea.value;
              if (!currentValue.includes(interimTranscript)) {
                textarea.placeholder = interimTranscript;
              }
            }
          }
        };
        
        recognition.onend = function() {
          isRecording = false;
          const voiceBtn = document.querySelector('.chat-voice-input-button');
          const floatingBtn = document.getElementById('floatingVoiceBtn');
          const textarea = document.querySelector('.chat-inputs textarea');
          
          if (voiceBtn) {
            voiceBtn.classList.remove('recording');
            voiceBtn.title = 'Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i';
          }
          if (floatingBtn) {
            floatingBtn.classList.remove('recording');
            floatingBtn.title = 'Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i';
          }
          if (textarea) {
            textarea.classList.remove('listening');
            // Reset placeholder tr√™n mobile
            if (isMobile && textarea.placeholder !== 'Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...') {
              textarea.placeholder = 'Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...';
            }
          }
        };
        
        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          isRecording = false;
          const voiceBtn = document.querySelector('.chat-voice-input-button');
          const floatingBtn = document.getElementById('floatingVoiceBtn');
          const textarea = document.querySelector('.chat-inputs textarea');
          
          if (voiceBtn) {
            voiceBtn.classList.remove('recording');
            voiceBtn.title = 'Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i';
          }
          if (floatingBtn) {
            floatingBtn.classList.remove('recording');
            floatingBtn.title = 'Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i';
          }
          if (textarea) {
            textarea.classList.remove('listening');
          }
          
          let errorMsg = 'C√≥ l·ªói x·∫£y ra khi ghi √¢m';
          switch(event.error) {
            case 'no-speech':
              errorMsg = 'Kh√¥ng ph√°t hi·ªán gi·ªçng n√≥i';
              break;
            case 'audio-capture':
              errorMsg = 'Kh√¥ng th·ªÉ truy c·∫≠p microphone';
              break;
            case 'not-allowed':
              errorMsg = 'Quy·ªÅn truy c·∫≠p microphone b·ªã t·ª´ ch·ªëi';
              break;
          }
          
          // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói t·∫°m th·ªùi
          showVoiceStatus(errorMsg, 'error');
        };
      }
      
      // Th√™m n√∫t voice input v√†o chat interface
      addVoiceButton();
      
      // Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n cho mobile
      if (isMobile) {
        setTimeout(() => {
          showVoiceStatus('üí° Tip: N√≥i r√µ r√†ng v√† ch·∫≠m r√£i tr√™n mobile', 'info');
        }, 2000);
      }
    }
    
    function addVoiceButton() {
      // Th·ª≠ t√¨m c√°c selector kh√°c nhau v√† th·ª≠ nhi·ªÅu l·∫ßn
      const selectors = [
        '.chat-inputs-controls[data-v-31e29ba2]',
        '.chat-inputs-controls',
        '.chat-inputs[data-v-31e29ba2] .chat-inputs-controls',
        '.chat-inputs .chat-inputs-controls'
      ];
      
      let chatInputsControls = null;
      for (const selector of selectors) {
        chatInputsControls = document.querySelector(selector);
        if (chatInputsControls) break;
      }
      
      if (chatInputsControls && !document.querySelector('.chat-voice-input-button')) {
        console.log('Found chat controls, adding voice button...');
        
        const voiceWrapper = document.createElement('div');
        voiceWrapper.className = 'chat-voice-input-wrapper';
        
        const voiceButton = document.createElement('button');
        voiceButton.className = 'chat-voice-input-button';
        voiceButton.title = 'Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i';
        voiceButton.type = 'button';
        
        voiceButton.innerHTML = `
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        `;
        
        voiceButton.addEventListener('click', toggleVoiceRecording);
        
        voiceWrapper.appendChild(voiceButton);
        
        // Th·ª≠ th√™m v√†o v·ªã tr√≠ ƒë·∫ßu ti√™n
        if (chatInputsControls.firstChild) {
          chatInputsControls.insertBefore(voiceWrapper, chatInputsControls.firstChild);
        } else {
          chatInputsControls.appendChild(voiceWrapper);
        }
        
        console.log('Voice button added successfully!');
        
        // Ki·ªÉm tra quy·ªÅn truy c·∫≠p microphone
        navigator.mediaDevices?.getUserMedia({ audio: true })
          .then(() => {
            console.log('Microphone access granted');
          })
          .catch((err) => {
            console.warn('Microphone access denied:', err);
            voiceButton.style.opacity = '0.5';
            voiceButton.title = 'Kh√¥ng th·ªÉ truy c·∫≠p microphone';
          });
      } else if (!chatInputsControls) {
        console.log('Chat controls not found, retrying...');
        // Th·ª≠ l·∫°i sau 1 gi√¢y
        setTimeout(addVoiceButton, 1000);
      }
    }
    
    function toggleVoiceRecording() {
      if (!recognition) {
        showVoiceStatus('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i', 'error');
        return;
      }
      
      if (isRecording) {
        recognition.stop();
        showVoiceStatus('ƒê√£ d·ª´ng ghi √¢m', 'success');
      } else {
        try {
          // Reset recognition tr√™n mobile ƒë·ªÉ tr√°nh l·ªói
          if (isMobile) {
            recognition.abort();
            setTimeout(() => {
              recognition.start();
            }, 100);
          } else {
            recognition.start();
          }
          
          showVoiceStatus(isMobile ? 'ƒêang nghe... N√≥i r√µ r√†ng' : 'B·∫Øt ƒë·∫ßu ghi √¢m...', 'info');
          
          // Th√™m timeout cho mobile ƒë·ªÉ tr√°nh treo
          if (isMobile) {
            setTimeout(() => {
              if (isRecording) {
                recognition.stop();
                showVoiceStatus('H·∫øt th·ªùi gian ghi √¢m', 'warning');
              }
            }, 15000); // 15 gi√¢y timeout
          }
        } catch (error) {
          console.error('Error starting recognition:', error);
          showVoiceStatus('L·ªói kh·ªüi ƒë·ªông microphone. H√£y th·ª≠ l·∫°i!', 'error');
          
          // Fallback: hi·ªÉn th·ªã h∆∞·ªõng d·∫´n thay th·∫ø
          if (isMobile) {
            setTimeout(() => {
              showVoiceStatus('üì± Th·ª≠ ƒë√≥ng c√°c app kh√°c v√† th·ª≠ l·∫°i', 'info');
            }, 3000);
          }
        }
      }
    }
    
    function showVoiceStatus(message, type = 'info') {
      const existingStatus = document.querySelector('.voice-status');
      if (existingStatus) {
        existingStatus.remove();
      }
      
      const statusDiv = document.createElement('div');
      statusDiv.className = 'voice-status';
      statusDiv.textContent = message;
      
      // Styling kh√°c bi·ªát cho mobile v√† desktop
      const bgColor = type === 'error' ? '#dc3545' : 
                     type === 'success' ? '#28a745' : 
                     type === 'warning' ? '#ffc107' : '#17a2b8';
      
      statusDiv.style.cssText = `
        position: fixed;
        ${isMobile ? 'top: 50%; left: 50%; transform: translate(-50%, -50%)' : 'top: 20px; right: 20px'};
        background: ${bgColor};
        color: ${type === 'warning' ? '#212529' : 'white'};
        padding: ${isMobile ? '15px 25px' : '10px 20px'};
        border-radius: ${isMobile ? '10px' : '5px'};
        z-index: 9999;
        font-size: ${isMobile ? '16px' : '14px'};
        font-weight: 500;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        max-width: ${isMobile ? '80vw' : 'auto'};
        text-align: center;
      `;
      
      document.body.appendChild(statusDiv);
      
      // Th·ªùi gian hi·ªÉn th·ªã kh√°c nhau cho mobile
      const displayTime = isMobile ? 2000 : 3000;
      setTimeout(() => {
        if (statusDiv.parentNode) {
          statusDiv.remove();
        }
      }, displayTime);
    }
    
    // S·ª≠ d·ª•ng MutationObserver ƒë·ªÉ theo d√µi thay ƒë·ªïi DOM
    function observeForChatWidget() {
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            // Ki·ªÉm tra xem c√≥ chat inputs controls n√†o ƒë∆∞·ª£c th√™m v√†o kh√¥ng
            const addedNodes = Array.from(mutation.addedNodes);
            const hasRelevantChanges = addedNodes.some(node => {
              if (node.nodeType === Node.ELEMENT_NODE) {
                return node.querySelector && (
                  node.querySelector('.chat-inputs-controls') ||
                  node.querySelector('.chat-inputs') ||
                  node.classList?.contains('chat-inputs') ||
                  node.classList?.contains('chat-inputs-controls')
                );
              }
              return false;
            });
            
            if (hasRelevantChanges && !document.querySelector('.chat-voice-input-button')) {
              console.log('Chat widget detected, adding voice button...');
              setTimeout(addVoiceButton, 100);
            }
          }
        });
      });

      // Quan s√°t to√†n b·ªô body
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
      
      // D·ª´ng observe sau 30 gi√¢y ƒë·ªÉ tr√°nh overhead
      setTimeout(() => {
        observer.disconnect();
      }, 30000);
    }
    
    // Kh·ªüi t·∫°o voice input khi DOM ƒë√£ ready
    document.addEventListener('DOMContentLoaded', () => {
      initVoiceInput();
      observeForChatWidget();
    });
    
    // Kh·ªüi t·∫°o ngay n·∫øu DOM ƒë√£ ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        initVoiceInput();
        observeForChatWidget();
      });
    } else {
      initVoiceInput();
      observeForChatWidget();
    }
    
    // K√≠ch ho·∫°t floating voice button
    function initFloatingVoiceButton() {
      const floatingBtn = document.getElementById('floatingVoiceBtn');
      if (floatingBtn) {
        floatingBtn.addEventListener('click', toggleVoiceRecording);
        
        // Hi·ªÉn th·ªã floating button sau 2 gi√¢y n·∫øu kh√¥ng t√¨m th·∫•y inline button
        setTimeout(() => {
          if (!document.querySelector('.chat-voice-input-button')) {
            console.log('Showing floating voice button...');
            floatingBtn.classList.add('show');
          }
        }, 2000);
      }
    }
    
    // Th√™m th√™m m·ªôt timeout backup ƒë·ªÉ ƒë·∫£m b·∫£o
    setTimeout(() => {
      if (!document.querySelector('.chat-voice-input-button')) {
        console.log('Backup: Adding voice button after 3 seconds...');
        addVoiceButton();
      }
    }, 3000);
    
    // Kh·ªüi t·∫°o floating button ngay l·∫≠p t·ª©c
    initFloatingVoiceButton();
  </script>
</head>
<body>
  <div id="chat-widget-container"></div>
  
  <!-- Floating Voice Button - Backup Solution -->
  <button class="floating-voice-button" id="floatingVoiceBtn" title="Nh·∫•n ƒë·ªÉ ghi √¢m gi·ªçng n√≥i">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
      <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
    </svg>
  </button>
</body>
</html>